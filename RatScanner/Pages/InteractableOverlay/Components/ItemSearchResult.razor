@using Color = MudBlazor.Color
@using System.Diagnostics;

<MudPaper Class="pa-2" Elevation="3" Style="">
    <MudStack Row="true" Justify="Justify.SpaceBetween" Style="height: 6vh;">
        <!--Left side of the search result item-->
        <MudStack Row="true" Justify="Justify.FlexStart" Class="flex-1" Style="">
            <MudPaper Style="aspect-ratio : 1 / 1;" Outlined="true">
                <MudImage Src="@Item.ImageLink"
                          Style="width: 100%; height: 100%; object-fit: contain;" />
            </MudPaper>

            <MudStack Justify="Justify.SpaceEvenly" AlignItems="AlignItems.End" Style="width: 4vw;">
                @{
                    var recycleRec = Item.GetRecycleRecommendation();
                    var recycleLabel = recycleRec.decision switch {
                        RecycleDecision.Recycle => "Recycle",
                        RecycleDecision.Keep => "Keep",
                        _ => "Sell"
                    };
                    var recycleColor = recycleRec.decision switch {
                        RecycleDecision.Recycle => Color.Warning,
                        RecycleDecision.Keep => Color.Success,
                        _ => Color.Default
                    };
                }
                <MudChip OnClose="() => { }" CloseIcon="@Icons.Material.Filled.Recycling" Size="Size.Small"
                         Variant="Variant.Outlined" Color="@recycleColor"
                         title="@recycleRec.reason">
                    @recycleLabel
                </MudChip>
            </MudStack>

            <MudDivider Vertical="true" FlexItem="true" />

            <MudStack Justify="Justify.SpaceEvenly" AlignItems="AlignItems.Start">
                <MudText Class="ellipsis" Typo="Typo.h6" Style="max-width: 16vw">
                    @Item.Name
                </MudText>
                <MudText Align="Align.Center">
                    @Item.ShortName
                    <MudIconButton Icon="@Icons.Material.Filled.OpenInNew" Size="Size.Small" OnClick=@(() => OpenURL(Item.WikiLink)) />
                </MudText>
            </MudStack>
        </MudStack>

        <!--Right side of the search result item-->
        <MudStack Row="true" Justify="Justify.FlexEnd">
            <MudStack Justify="Justify.SpaceEvenly" AlignItems="AlignItems.End" Style="width: 8vw" Spacing="0">
                <MudText Typo="Typo.h6">
                    @Item.Value.AsCredits()
                </MudText>
                <MudText>
                    @Item.ValuePerSlot.AsCredits()
                </MudText>
            </MudStack>

            <MudDivider Vertical="true" FlexItem="true" />

            <MudStack Justify="Justify.SpaceEvenly" AlignItems="AlignItems.Center" Style="width: 6vw" Spacing="0">
                <MudText Typo="Typo.subtitle2">@Item.Rarity</MudText>
                <MudText Typo="Typo.subtitle2">@($"{Item.Weight:0.##} kg")</MudText>
            </MudStack>
        </MudStack>
    </MudStack>
</MudPaper>

<style>
    .ellipsis {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-width: 0;
    }
</style>

@code {
    [Parameter]
    public required ArcRaidersData.ArcItem Item { get; set; }

    [Parameter]
    public bool IsExpanded { get; set; }

    private void OpenURL(string? url) {
        if (string.IsNullOrEmpty(url)) return;
        var psi = new ProcessStartInfo {
            FileName = url,
            UseShellExecute = true,
        };
        Process.Start(psi);
    }
}
